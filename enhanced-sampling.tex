\section{Enhanced sampling [Write as supplements, which can later be broken out as separate documents?]}
\label{sec:enhanced}

While recent advances in computational hardware have allowed MD simulations of systems with biological relevance to routinely reach timescales ranging from hundreds of \si{\nano\second} to \si{\micro\second}, in many cases this is still not long enough to obtain equilibrated (i.e. Boltzmann-weighted) structural populations. Enhanced sampling methods can be used to obtain well-converged ensembles faster than conventional MD. In general, enhanced sampling methods work through a combination of modifying the underlying energy landscape to increase the rate at which energy barriers are crossed with some form of reweighting to recover the unbiased ensemble. However, their use does not automatically guarantee a converged ensemble, and care must be taken when using and evaluating enhanced sampling methods.

\subsection{Replica Exchange Molecular Dynamics}
One of the most popular enhanced sampling methods is replica exchange MD (REMD).\citep{Sugita1999} Broadly speaking, REMD consists of running a number of non-interacting replicas of a system, each with a different Hamiltonian, and periodically exchanging system coordinates between Hamiltonians.

\subsubsection{Before Starting REMD}
\begin{itemize}
  \item Is REMD needed? Can the process be observed multiple times via conventional MD?
  \item Is dynamic information needed (e.g. diffusion, etc). This information is not easily extracted from REMD simulations.
  \item Is REMD computationally feasible? Typical implementations of REMD require at least 1 computational node per replica. In general, the number of replicas needed to get reasonable exchange rates is proportional to the square root of the number of degrees of freedom that vary between different replicas.
  \item What system variable(s) should be modified to increase sampling? Consider what the barriers to sampling are. Temperature is probably the most commonly used variable, but can be problematic: 1) temperature is only good for accelerating certain processes (e.g. protein unfolding but not folding), 2) temperature affects all degrees of freedom of a system and so typically requires large numbers of replicas, especially for explicitly solvated systems. It may be worthwhile to consider a different modification of the Hamiltonian, such as scaling dihedral force constants.
  \item Replica spacing and exchange acceptance percentage. Replicas need to be spaced such that the overlap in neighboring Hamiltonians is enough to ensure that a certain number of exchange attempts are accepted. Sugita and Okamoto\citep{Sugita1999} originally suggested exchange acceptance be no lower than 10\%, although it is more common in the literature to see target acceptance rate of 20\%. Procedures exist for generating replica temperature "ladders" to achieve a desired exchange acceptance, such as the one by Patriksson and van der Spoel.\citep{Patriksson2008}
\end{itemize}

\subsubsection{Running REMD}
\begin{itemize}
  \item Number of independent simulations. As with any MD simulation, statistically relevant results for REMD simulations are best achieved when running at least two (and ideally more) independent runs.
  \item Starting ensemble. In order to ensure that the REMD simulation will be sampling effectively, it is important to have a diverse starting ensemble (i.e. the initial set of coordinates of each replica) so as not to bias the simulation too strongly to any one state. The starting ensemble should ideally represent as much diversity as one hopes to see in the simulation. For example, if one wants to study folding/unfolding, the starting ensemble should be made up of both folded and unfolded structures.
  \item Exchange frequency to use. There is some debate in the literature. Sindhikara et al. have advocated exchanging as often as possible,\citep{Sindhikara2010} while Abraham and Gready have pointed out that exchanges shorter than then autocorrelation time of the potential energy of the system are not independent.\citep{Abraham2008} In addition, more frequent exchanges can lead to more parallel overhead, reducing computational efficiency. The general consensus in the literature appears to be that 1 ps per exchange attempt is reasonable.
  \item Coordinate output frequency to use. Because REMD simulations generate coordinates from each replica they produce much more data than conventional MD simulations. As a result it is often beneficial to write trajectory information less frequently than you normally would (e.g. every 10 ps). 
\end{itemize}

\subsubsection{Assessing REMD Convergence/Efficiency}
In order to assess the results of a REMD simulation, it is important to consider not just the overall convergence of the simulation to the correct Boltzmann-weighted ensemble of structures (via combined clustering, combined PC projection overlap analysis, etc.), but how efficiently the REMD simulation is doing so. These concepts are termed "thermodynamic efficiency" and "mixing efficiency" by Abraham and Gready,\citep{Abraham2008} and it is quite possible to achieve one without the other; both must be assessed. In order for sampling to be efficient, coordinates must be able to move freely in replica space. 

Below we will refer to both "coordinate trajectories" and "replica trajectories". A "coordinate trajectory" follows a single structure as it traverses replica space (e.g. a structure experiencing multiple temperatures as it is exchanged during a temperature REMD simulation). A "replica trajectory" is all structures corresponding to a single replica, i.e. Hamiltonian (e.g. all structures at a temperature of 300 K in a temperature REMD simulation).

\begin{itemize}
  \item Exchange acceptance. The exchange acceptance rate (i.e. the number of exchanges divided by the number of exchange attempts) between neighboring replicas should be roughly equivalent to each other and to the target acceptance rate. If the exchange acceptance is too low then replica spacing may need to be decreased or additional replicas used, and vice versa if the exchange acceptance is too high.
  \item Replica round-trips. The time taken for a set of coordinates to travel from the lowest replica to the highest and back is called the replica "round trip" time. Over the course of a REMD simulation, any given set of coordinates should make multiple round trips. In addition one can look at the average, minimum, and maximum round trip times: these should be roughly equivalent for any given set of coordinates. See e.g. Figure 6 in Roe et al..\citep{Roe2014}
  \item Replica residence time. The time any given set of coordinates spends at a replica is called the "replica residence time". For replica sampling to be efficient, the average replica residence time for each set of starting coordinates at each replica should be roughly equivalent. See e.g. Figure 7 in Roe et al..\citep{Roe2014}
  \item Distributions of quantities calculated from coordinate trajectories. If all coordinates are moving freely in replica space, they should eventually converge to the same ensemble of structures. Comparing distributions of various quantities from coordinate trajectories can provide a measure of how converged the simulation is. For example, one can compare the distribution of RMSD values of coordinate trajectories to a common reference structure; see e.g. Figure 8 in Henriksen et al..\citep{Henriksen2013} Poor overlap can be an indication that replica efficiency is poor or the simulation is not yet converged.
\end{itemize}

All of the above quantities (replica residence time, round trip time, lifetimes etc) can be calculated with CPPTRAJ,\citep{Roe2013} which is freely available from \url{https://github.com/Amber-MD/cpptraj} or as part of AmberTools (\url{http://ambermd.org}).

\subsection{NOTES-FIXME}
\begin{itemize}
  \item Compare to standard sampling (e.g., straight MD) for a simple system
  \item Complex correlation structures in complex methods indicate comparison of multiple independent runs will be useful
  \item Explain what to compare [Dan Z]
  \item Replica exchange [Daniel Roe]
    - Round-trips (necessary but not sufficient)
    - Compare ‘coordinate trajectories’ - distributions from temperature/Hamiltonian-wandering trajectories should match
    - Examine replica residence times
  \item Weighted ensemble (WE)
    - See this WE overview doc, particularly limitations section
    - Key concept: ‘Tree’ of trajectories generated by WE leads to strong correlations, requiring care
    - Key concept: WE simulation generically relaxes from the initial distribution toward the ultimate distribution which could be equilibrium (if no feedback/recycling or external driving) or a non-equilibrium steady state (if feedback from specified target to initial state)
  \item Safest approach: Use multiple runs, which are fully independent.  Perform as many runs as needed to reduce the statistical uncertainty (std err of mean) for quantity of interest
    - For a single observable, the time course of the value can be analyzed using the usual methods of analyzing time-correlated data (see above - e.g., block-averaging)
\end{itemize}
