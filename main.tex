%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% LIVECOMS ARTICLE TEMPLATE FOR BEST PRACTICES GUIDE
%%% ADAPTED FROM ELIFE ARTICLE TEMPLATE (8/10/2017)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% PREAMBLE
\documentclass[9pt,bestpractices]{livecoms}
% Use the 'onehalfspacing' option for 1.5 line spacing
% Use the 'doublespacing' option for 2.0 line spacing
% Use the 'lineno' option for adding line numbers.
% The 'bestpractices' option for indicates that this is a best practices guide.
% Omit the bestpractices option to remove the marking as a LiveCoMS paper.
% Please note that these options may affect formatting.

\usepackage{lipsum} % Required to insert dummy text
\usepackage[version=4]{mhchem}
\usepackage{siunitx}
\DeclareSIUnit\Molar{M}
\usepackage[italic]{mathastext}
\newcommand{\versionnumber}{1.0}  % you should update the minor version number in preprints and major version number of submissions.
\newcommand{\githubrepository}{\url{https://github.com/dmzuckerman/Sampling-Uncertainty}}  %this should be the main github repository for this article
\graphicspath{{figures/}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% ARTICLE SETUP
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Best Practices for Quantification of Uncertainty and Sampling Quality in Molecular Simulations: v\versionnumber}

% Everyone should put in their name properly, institution, email
\author[1*\authfn{1}]{Alan Grossfield}
%\author[2*\authfn{1}]{Pascal T. Merz}
\author[2*\authfn{1}]{Paul N. Patrone}
\author[3*\authfn{1}]{Daniel R. Roe}
\author[4*\authfn{1}]{Andrew J. Schultz}
\author[5*\authfn{1}]{Daniel W. Siderius}
\author[6*\authfn{1}]{Daniel M. Zuckerman}
\affil[1]{University of Rochester Medical Center, Department of Biochemistry and Biophysics}
%\affil[2]{Department of Chemical and Biological Engineering, University of Colorado Boulder}
\affil[2]{Applied Computational and Mathematics Division, National Institute of Standards and Technology}
\affil[3]{Laboratory of Computational Biology, National Heart Lung and Blood Institute, National Institutes of Health}
\affil[4]{Department of Chemical and Biological Engineering, University at Buffalo, The State University of New York}
\affil[5]{Chemical Sciences Division, National Institute of Standards and Technology}
\affil[6]{Department of Biomedical Engineering, Oregon Health \& Science University}

%\corr{email1@example.com}{FMS}  % Correspondence emails.  FMS and FS are the appropriate authors initials.
\corr{alan_grossfield@urmc.rochester.edu}{AG}
%\corr{Pascal.Merz@colorado.edu}{PTM}
\corr{paul.patrone@nist.gov}{PNP}
\corr{daniel.roe@nih.gov}{DRR}
\corr{ajs42@buffalo.edu}{AJS}
\corr{daniel.siderius@nist.gov}{DWS}
\corr{zuckermd@ohsu.edu}{DMZ}

\contrib[\authfn{1}]{These authors contributed equally to this work.}

\blurb{This LiveCoMS document is maintained online on GitHub at \githubrepository; to provide feedback, suggestions, or help improve it, please visit the GitHub repository and participate via the issue tracker.}

%% Common symbols
\newcommand{\stdev}[1]{s\left( #1 \right)}
\newcommand{\stdevmean}[1]{s\left( #1 \right)}
\newcommand{\expval}[1]{\langle #1 \rangle}
\newcommand{\mean}[1]{\bar{#1}}

%\presentadd[\authfn{3}]{Department, Institute, Country}
%\presentadd[\authfn{4}]{Department, Institute, Country}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% ARTICLE START
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\begin{frontmatter} %NOTE: to make the document single column, just take out the {frontmatter} sentinels
\maketitle

\begin{abstract}
The quantitative assessment of uncertainty and sampling quality is essential in molecular simulation.
Many systems of interest are highly complex, at the edge of current computational capacity, and simulators must understand and communicate statistical uncertainties so that `consumers' of the data understand the meaning and limitations of the simulation data.
This article covers key analyses appropriate for trajectory data generated by straightforward simulation methods such as molecular dynamics and (single Markov chain) Monte Carlo, as well as providing guidance for analyzing some `enhanced' sampling approaches.
We do not discuss \emph{systematic} errors arising from inaccuracy in the chosen model or force field.
\end{abstract}

\end{frontmatter}

\section{Introduction: Scope and definitions}
\label{sec:scope}
% \subsection{Scope}
\input{scope}

%\subsection{Key Definitions [to be refined]}
\input{definitions}

\section{Best Practices Checklist}

The self-contained checklist is presented on the following page.

\begin{Checklists*}[p!]
\begin{checklist}{Quantifying Uncertainty and Sampling Quality in Molecular Simulation}
\begin{itemize}
\item
\textbf{Plan your study carefully: Start with pre-simulation sanity checks.}  \emph{Underlying concept:} There is no guarantee that any method, enhanced or otherwise, can sample the system of interest.  See Sec.\ \ref{sec:sanity}
    \begin{itemize}
    \item See best-practices papers on simulation background and planning/setup [\url{https://github.com/MobleyLab/basic_simulation_training}]
    \item Are system timescales known experimentally and feasible computationally based on published literature?
      If timescales are too long for straight-ahead MD, is there an enhanced method for which there are precedents for systems of similar complexity?
    \item Read up on sampling assessment -- from this article or another source (e.g., \cite{Grossfield2009}).  Understanding uncertainty will help in the \emph{planning} of a simulation.
      %- Key concept: Connection between the equilibrium ensemble and individual trajectory (may or may not reach equilibrium); equilibrium vs. non-equilibrium.
    \item Consider multiple runs instead of a single simulation.  Diverse starting structures enable a check on sampling for equilibrium ensembles, which should not depend on the starting structure.  Multiple runs may be especially useful in assessing uncertainty for enhanced sampling methods.  
    %The starting structures should be as representative of the true ensemble as you can make them, and should be generated in an automated fashion (as opposed to using interactive setups) for better reproducibility,
    \item Check your code/method via a simple benchmark system.  See: \url{https://github.com/shirtsgroup/software-physical-validation}
    \end{itemize}
\item
\textbf{Perform simple, semi-quantitative checks which can rule out (but not ensure) sufficient sampling.} \emph{Underlying concept:} It is easier to diagnose insufficient sampling than to demonstrate good sampling.  See Sec.\ \ref{sec:quick}.
    \begin{itemize}
    \item Critically examine the time series of a number of observables -- those of interest and then some more.  Is each time series fluctuating about an average value or drifting overall?  What states are expected and what are seen?  Are there a significant number of transitions between states?
    %\item Plot as many properties as you can think of, even if they’re not interesting
    \item If multiple runs have been performed, compare time series, distributions, and cluster populations from the different simulations.
    \item An individual trajectory can be divided into two parts and analyzed as if two simulations had been run.
    \item For individual runs, perform pairwise RMSD visual analysis as described below.
    %\item Plot pairwise configurational distances (e.g., RMSD values for biomolecules) in greyscale for $\sim$100 evenly spaced frames
    %\item Visualize the trajectory graphically -- look for slow motions.  BE SKEPTICAL!
    %\item Compare observable different fractions of a run (DMZ thirds idea)
    %\item Andrew: short vs. very short [DMZ: this would need to be described somewhere]
    %\item Daniel R: Compare runs from different initial conditions - be sure initial conditions are ‘different enough’
    \end{itemize}
\item
 \textbf{Remove an ‘equilibration' (a.k.a. `burn in', or transient) portion of a single MD or MC trajectory} and perform analyses only on the remaining ‘production’ portion of trajectory.  \emph{Underlying concept:} An initial configuration is unlikely to be representative of the desired ensemble and the resulting relaxation process must be accounted for.  See Sec.\ \ref{sec:equil}.
\item
 \textbf{Consider computing a quantitative measure of global sampling, particularly for a biomolecular system} - i.e., attempt to estimate the number of statistically independent samples in a trajectory.  \emph{Underlying concept:} Trajectory 'frames' (configurations) are highly correlated because one frame is generated from the preceding one, and estimating the degree of correlation is essential to understanding overall simulation quality.  See Sec.\ \ref{sec:global}.
\item
 \textbf{Quantify uncertainty in specific observables of interest using a confidence interval.}  \emph{Underlying concept:} The statistical uncertainty in the estimate of an observable's \emph{average} decreases as more independent samples are obtained, and can be much smaller than the standard deviation -- which measures the range of variation in the observable.  See Sec.\ \ref{sec:specific}.
\item
\textbf{Use special care and uncertainty analyses for enhanced sampling methods.}  \emph{Underlying concept:} The use of multiple, potentially correlated trajectories within a single enhanced-sampling simulation can invalidate the assumptions underpinning traditional analyses of uncertainty.  See Sec.\ \ref{sec:enhanced}.
\end{itemize}
\end{checklist}
\end{Checklists*}


% we will have a bunch of includes here
\input{pre-sim-sanity.tex}
\input{quick-and-dirty.tex}
\input{equilibration-burn-in.tex}
\input{global-sampling.tex}
\input{specific-observables.tex}
\input{enhanced-sampling.tex}


\section{Acknowledgments}
%Funder and other information can be given here.
The authors appreciate helpful discussions with Pascal T. Merz and comments from Lillian T. Chong.
DMZ acknowledges support from NIH Grant GM115805.


\bibliography{refs}
%\bibliographystyle{vancouver-livecoms}

\end{document}
